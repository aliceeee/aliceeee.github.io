<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/img/avatar.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/img/avatar.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/img/avatar.jpg">
  <link rel="mask-icon" href="/img/avatar.jpg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"aliceeee.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Introduction官方：http:&#x2F;&#x2F;nginx.org&#x2F;en&#x2F;docs&#x2F;beginners_guide.html Nginx VS. Nginx Plus: https:&#x2F;&#x2F;www.nginx.com&#x2F;products&#x2F;nginx&#x2F;#compare-versions">
<meta property="og:type" content="article">
<meta property="og:title" content="Nginx Configuration">
<meta property="og:url" content="http://aliceeee.github.io/Tech/Web/Nginx-Configuration/index.html">
<meta property="og:site_name" content="Alice&#39;s Secret Base">
<meta property="og:description" content="Introduction官方：http:&#x2F;&#x2F;nginx.org&#x2F;en&#x2F;docs&#x2F;beginners_guide.html Nginx VS. Nginx Plus: https:&#x2F;&#x2F;www.nginx.com&#x2F;products&#x2F;nginx&#x2F;#compare-versions">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2019-04-12T16:19:20.000Z">
<meta property="article:modified_time" content="2023-01-30T05:56:52.925Z">
<meta property="article:author" content="Alice">
<meta property="article:tag" content="nginx">
<meta property="article:tag" content="configuration">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://aliceeee.github.io/Tech/Web/Nginx-Configuration/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Nginx Configuration | Alice's Secret Base</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Alice's Secret Base</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://aliceeee.github.io/Tech/Web/Nginx-Configuration/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/avatar.jpg">
      <meta itemprop="name" content="Alice">
      <meta itemprop="description" content="Too lazy to write...">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Alice's Secret Base">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Nginx Configuration
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-04-12 16:19:20" itemprop="dateCreated datePublished" datetime="2019-04-12T16:19:20+00:00">2019-04-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-01-30 05:56:52" itemprop="dateModified" datetime="2023-01-30T05:56:52+00:00">2023-01-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tech/" itemprop="url" rel="index"><span itemprop="name">Tech</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>4k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>4 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>官方：<a target="_blank" rel="noopener" href="http://nginx.org/en/docs/beginners_guide.html">http://nginx.org/en/docs/beginners_guide.html</a></p>
<p>Nginx VS. Nginx Plus: <a target="_blank" rel="noopener" href="https://www.nginx.com/products/nginx/#compare-versions">https://www.nginx.com/products/nginx/#compare-versions</a></p>
<span id="more"></span>

<h2 id="Concept"><a href="#Concept" class="headerlink" title="Concept"></a>Concept</h2><ul>
<li>Directives: Simple (single‑line) directives; Block directives</li>
<li>Contexts: A few top‑level directives, referred to as contexts, group together the directives that apply to different traffic types. Directives placed outside of these contexts are said to be in the main context.<ul>
<li>events – General connection processing</li>
<li>http – HTTP traffic</li>
<li>mail – Mail traffic</li>
<li>stream – TCP and UDP traffic</li>
</ul>
</li>
<li>Virtual Servers: <code>server</code> blocks</li>
<li>Inheritance: <ul>
<li><blockquote>
<p>See <a target="_blank" rel="noopener" href="http://blog.martinfjordvald.com/2012/08/understanding-the-nginx-configuration-inheritance-model/">UNDERSTANDING THE NGINX CONFIGURATION INHERITANCE MODEL</a></p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h2 id="Configuration-File"><a href="#Configuration-File" class="headerlink" title="Configuration File"></a>Configuration File</h2><p>Configuration file is typically one of &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf, &#x2F;etc&#x2F;nginx, or &#x2F;usr&#x2F;local&#x2F;etc&#x2F;nginx.</p>
<p>文件最后一般有includes，例如：include &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;vhost&#x2F;*.conf;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">user nobody; # a directive in the &#x27;main&#x27; context</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    # configuration of connection processing</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    # Configuration specific to HTTP and affecting all virtual servers  </span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        # configuration of HTTP virtual server 1       </span><br><span class="line">        location /one &#123;</span><br><span class="line">            # configuration for processing URIs starting with &#x27;/one&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">        location /two &#123;</span><br><span class="line">            # configuration for processing URIs starting with &#x27;/two&#x27;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">    </span><br><span class="line">    server &#123;</span><br><span class="line">        # configuration of HTTP virtual server 2</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">stream &#123;</span><br><span class="line">    # Configuration specific to TCP/UDP and affecting all virtual servers</span><br><span class="line">    server &#123;</span><br><span class="line">        # configuration of TCP virtual server 1 </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>See <a target="_blank" rel="noopener" href="https://docs.nginx.com/nginx/admin-guide/basic-functionality/managing-configuration-files/#sample-configuration-file-with-multiple-contexts">Sample Configuration File with Multiple Contexts</a></p>
</blockquote>
<h2 id="Debug-Nginx-Configuration"><a href="#Debug-Nginx-Configuration" class="headerlink" title="Debug Nginx Configuration"></a>Debug Nginx Configuration</h2><p>error_log 默认<code>[notice]</code>级别</p>
<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error_log    /var/logs/nginx/error.log debug;</span><br></pre></td></tr></table></figure>

<p>仅收集rewrite错误</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    error_log    /var/logs/nginx/error.log;</span><br><span class="line">    rewrite_log on;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>仅调试&#x2F;admin&#x2F;部分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    #other config</span><br><span class="line">    error_log    /var/logs/nginx/example.com.error.log;</span><br><span class="line">    location /admin/ &#123; </span><br><span class="line">        error_log /var/logs/nginx/admin-error.log debug; </span><br><span class="line">    &#125;         </span><br><span class="line">    #other config</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Nginx 记录仅仅来自于你的 IP 的错误日志</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">events &#123;</span><br><span class="line">        debug_connection 1.2.3.4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Virtual-Servers"><a href="#Virtual-Servers" class="headerlink" title="Virtual Servers"></a>Virtual Servers</h2><p>One or more server blocks define virtual servers</p>
<h2 id="Serving-Static-Content"><a href="#Serving-Static-Content" class="headerlink" title="Serving Static Content"></a>Serving Static Content</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    location / &#123;</span><br><span class="line">        root /data/www;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location /images/ &#123;</span><br><span class="line">        root /data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Reverse-Proxy"><a href="#Reverse-Proxy" class="headerlink" title="Reverse Proxy"></a>Reverse Proxy</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">upstream tomcats &#123;</span><br><span class="line">    server 127.0.0.1:9001;</span><br><span class="line">    server 127.0.0.1:9002;</span><br><span class="line">&#125;</span><br><span class="line">location / &#123;</span><br><span class="line">    proxy_pass_header Server;</span><br><span class="line">    proxy_set_header Host $http_host;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    proxy_pass http://tomcats;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>See <a target="_blank" rel="noopener" href="https://docs.nginx.com/nginx/admin-guide/web-server/reverse-proxy/">NGINX Reverse Proxy</a><br>See <a target="_blank" rel="noopener" href="http://nginx.org/en/docs/http/ngx_http_upstream_module.html#upstream">nginx http upstream module</a></p>
</blockquote>
<h3 id="Custom-Error-Page"><a href="#Custom-Error-Page" class="headerlink" title="Custom Error Page"></a>Custom Error Page</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">        proxy_pass http://example/;</span><br><span class="line">        proxy_set_header  X-Real-IP  $remote_addr;</span><br><span class="line">        proxy_set_header  X-Forwarded-For  $remote_addr;</span><br><span class="line">        error_page 502 503 504 = /maintainance.html;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location = /maintainance.html &#123;</span><br><span class="line">        root /path/to/html/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">500 502 503 504 @jump_to_error;</span><br><span class="line">location @jump_to_error &#123;    </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Websocket-Support"><a href="#Websocket-Support" class="headerlink" title="Websocket Support"></a>Websocket Support</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location ~ /ws &#123;</span><br><span class="line">  proxy_pass http://127.0.0.1:8888;</span><br><span class="line">  proxy_http_version 1.1;</span><br><span class="line">  proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">  proxy_set_header Connection &quot;upgrade&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Nginx-Error-Code"><a href="#Nginx-Error-Code" class="headerlink" title="Nginx Error Code"></a>Nginx Error Code</h2><blockquote>
<p>See <a target="_blank" rel="noopener" href="https://www.nginx.com/resources/wiki/extending/api/http/#http-return-codes">HTTP Return Codes</a></p>
</blockquote>
<h3 id="403-x2F-Forbidden-errors"><a href="#403-x2F-Forbidden-errors" class="headerlink" title="403 &#x2F; Forbidden errors"></a>403 &#x2F; Forbidden errors</h3><p>对于Nginx代理spring boot项目websocket出现403，修改配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Pass the csrf token (see https://de.wikipedia.org/wiki/Cross-Site-Request-Forgery)</span><br><span class="line"># Default in Spring Boot and required. Without it nginx suppresses the value</span><br><span class="line">proxy_pass_header X-XSRF-TOKEN;</span><br><span class="line"></span><br><span class="line"># Set origin to the real instance, otherwise a of Spring security check will fail</span><br><span class="line"># Same value as defined in proxy_pass</span><br><span class="line">proxy_set_header Origin &quot;http://testsysten:8080&quot;;  </span><br></pre></td></tr></table></figure>

<blockquote>
<p>See <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/34136630/nginx-reverse-proxy-websocket-authentication-http-403">Nginx Reverse Proxy Websocket Authentication - HTTP 403
</a></p>
</blockquote>
<h3 id="499-x2F-ClientClosed-Request"><a href="#499-x2F-ClientClosed-Request" class="headerlink" title="499 &#x2F; ClientClosed Request"></a>499 &#x2F; ClientClosed Request</h3><blockquote>
<p>499 &#x2F; ClientClosed Request</p>
<p>   An Nginx HTTP server extension. This codeis introduced to log the case when the connection is closed by client whileHTTP server is processing its request, making server unable to send the HTTP header back</p>
</blockquote>
<p>Solution</p>
<ul>
<li>解决server响应慢问题，在client close请求前返回</li>
<li>nginx增加配置，不要主动关闭客户端的连接<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxy_ignore_client_abort  on; </span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>See <a target="_blank" rel="noopener" href="https://blog.51cto.com/yucanghai/1713803">服务器排障 之 nginx 499 错误的解决</a></p>
</blockquote>
<h3 id="504-x2F-Gateway-Timeout-error"><a href="#504-x2F-Gateway-Timeout-error" class="headerlink" title="504 &#x2F; Gateway Timeout error"></a>504 &#x2F; Gateway Timeout error</h3><p>For Nginx as Proxy for Apache web server, this is what you have to try to fix the 504 Gateway Timeout error:</p>
<p>Add these variables to nginx.conf file:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">proxy_connect_timeout       300;</span><br><span class="line">proxy_send_timeout          300;</span><br><span class="line">proxy_read_timeout          300;</span><br><span class="line">send_timeout                300;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>See <a target="_blank" rel="noopener" href="https://www.scalescale.com/tips/nginx/504-gateway-time-out-using-nginx/">How to Fix 504 Gateway Timeout using Nginx</a></p>
</blockquote>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/nginx/" rel="tag"># nginx</a>
              <a href="/tags/configuration/" rel="tag"># configuration</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/Tech/Engineering/Git-Cheatsheet/" rel="prev" title="Git Cheatsheet">
      <i class="fa fa-chevron-left"></i> Git Cheatsheet
    </a></div>
      <div class="post-nav-item">
    <a href="/Tech/Cloud/Kubernetes-Cheatsheet/" rel="next" title="Kubernetes Cheatsheet">
      Kubernetes Cheatsheet <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Introduction"><span class="nav-number">1.</span> <span class="nav-text">Introduction</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Concept"><span class="nav-number">2.</span> <span class="nav-text">Concept</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Configuration-File"><span class="nav-number">3.</span> <span class="nav-text">Configuration File</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Debug-Nginx-Configuration"><span class="nav-number">4.</span> <span class="nav-text">Debug Nginx Configuration</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Virtual-Servers"><span class="nav-number">5.</span> <span class="nav-text">Virtual Servers</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Serving-Static-Content"><span class="nav-number">6.</span> <span class="nav-text">Serving Static Content</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reverse-Proxy"><span class="nav-number">7.</span> <span class="nav-text">Reverse Proxy</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Custom-Error-Page"><span class="nav-number">7.1.</span> <span class="nav-text">Custom Error Page</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Websocket-Support"><span class="nav-number">7.2.</span> <span class="nav-text">Websocket Support</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Nginx-Error-Code"><span class="nav-number">8.</span> <span class="nav-text">Nginx Error Code</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#403-x2F-Forbidden-errors"><span class="nav-number">8.1.</span> <span class="nav-text">403 &#x2F; Forbidden errors</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#499-x2F-ClientClosed-Request"><span class="nav-number">8.2.</span> <span class="nav-text">499 &#x2F; ClientClosed Request</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#504-x2F-Gateway-Timeout-error"><span class="nav-number">8.3.</span> <span class="nav-text">504 &#x2F; Gateway Timeout error</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Alice"
      src="/img/avatar.jpg">
  <p class="site-author-name" itemprop="name">Alice</p>
  <div class="site-description" itemprop="description">Too lazy to write...</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">30</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Alice</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="Symbols count total">53k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">48 mins.</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
